<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-10-28 Wed 14:11 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6effb9d">1. Design notes</a>
<ul>
<li><a href="#orgacf6803">1.1. Requirements</a>
<ul>
<li><a href="#orgf2f1238">1.1.1. Requirement</a></li>
<li><a href="#org1cf36cd">1.1.2. Requirement</a></li>
<li><a href="#org238d872">1.1.3. Requirement</a></li>
<li><a href="#org41f1458">1.1.4. Requirement</a></li>
</ul>
</li>
<li><a href="#org3888f60">1.2. JSON document generation request design for web client (BIEL)</a>
<ul>
<li><a href="#org24eca66">1.2.1. Example request from <code>test_flask.py</code></a></li>
</ul>
</li>
<li><a href="#org838beab">1.3. Interactions at a high level</a></li>
<li><a href="#orge41a37c">1.4. What works currently</a></li>
<li><a href="#org81eb4ed">1.5. Docker container</a></li>
<li><a href="#orgc8dfeb0">1.6. How to run a demo for yourself</a>
<ul>
<li><a href="#orgcc8eb61">1.6.1. Set up for demos</a></li>
<li><a href="#orgc90937b">1.6.2. Run demo outside Docker container (faster)</a>
<ul>
<li><a href="#org85daf53">1.6.2.1. For <code>resource_lookup.py</code>:</a></li>
<li><a href="#orgf7d0ac1">1.6.2.2. For <code>document_generator.py</code> (used to be named <code>export_md_to_pdf.py</code>):</a></li>
<li><a href="#org3d31383">1.6.2.3. For testing the web service front end do:</a></li>
</ul>
</li>
<li><a href="#org10c2c48">1.6.3. For demo inside the Docker container (slower):</a></li>
</ul>
</li>
<li><a href="#org4839fe2">1.7. (Bonus/optional material) Convenience web service endpoints for BIEL UI to call (if desired)</a>
<ul>
<li><a href="#orgd055a6c">1.7.1. Example client call to get all language codes (sans language name)</a></li>
<li><a href="#org6fa2dd8">1.7.2. Get all language code, language name pairs</a></li>
</ul>
</li>
<li><a href="#orgf9a4226">1.8. Oddities - differences from the norm in resources I've found</a>
<ul>
<li><a href="#orge00f25f">1.8.1. <span class="todo TODO">TODO</span> for Craig: a license for the <code>Interleaved_Resources_Generator</code> project</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org6effb9d" class="outline-2">
<h2 id="org6effb9d"><span class="section-number-2">1</span> Design notes</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgacf6803" class="outline-3">
<h3 id="orgacf6803"><span class="section-number-3">1.1</span> Requirements</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orgf2f1238" class="outline-4">
<h4 id="orgf2f1238"><span class="section-number-4">1.1.1</span> Requirement</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Allow creating a document out of any combination of resources from any
supported (in translations.json) language in any order.
</p>
</div>
</div>
<div id="outline-container-org1cf36cd" class="outline-4">
<h4 id="org1cf36cd"><span class="section-number-4">1.1.2</span> Requirement</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
Produce PDF final document.
</p>
</div>
</div>
<div id="outline-container-org238d872" class="outline-4">
<h4 id="org238d872"><span class="section-number-4">1.1.3</span> Requirement</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
If generation of PDF document takes longer than X threshold of time,
then return a message to the user giving link where document will
eventually be found. E.g., display message to user in interface, say
after a cache miss on document request, or, via email. Details to be
determined.
</p>
</div>
</div>
<div id="outline-container-org41f1458" class="outline-4">
<h4 id="org41f1458"><span class="section-number-4">1.1.4</span> Requirement</h4>
<div class="outline-text-4" id="text-1-1-4">
<p>
Handle TN, TA, TW, TQ, ULB, UDB resource requests. Later perhaps also
OBS, etc..
</p>
</div>
</div>
</div>
<div id="outline-container-org3888f60" class="outline-3">
<h3 id="org3888f60"><span class="section-number-3">1.2</span> JSON document generation request design for web client (BIEL)</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Currently the JSON looks like this, for example:
</p>

<div class="org-src-container">
<pre class="src src-js">{ "resources":
  { "lang_code": "am", "resource_type": "ulb", "resource_code": "gen" },
  { "lang_code": "lpx", "resource_type": "tn", "resource_code": "exo" },
  ...
}
</pre>
</div>

<p>
Each element in the JSON dictionary represents a resource. The whole
dictionary represents all the resources you want in the final typeset
document in the order you want them. Note that last point: the order.
That could of course be changed, but I am for now making an assumption
that BIEL's wizard would compose a JSON document generation request
having resources in the order the user requested the document's
resources to be represented.
</p>
</div>
<div id="outline-container-org24eca66" class="outline-4">
<h4 id="org24eca66"><span class="section-number-4">1.2.1</span> Example request from <code>test_flask.py</code></h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
Example python client request using resources JSON dictionary to submit an
API call to generate a document composed of resources. I imagine <code>BIEL</code>
would make this client request, instead, in Javascript.
</p>

<div class="org-src-container">
<pre class="src src-python">import json
import requests

payload = {}
payload["resources"] = [
    {"lang_code": "am",
     "resource_type": "ulb",
     "resource_code": "gen"},
    {"lang_code": "erk-x-erakor",
     "resource_type": "reg",
     "resource_code": "eph"},
    {"lang_code": "ml",
     "resource_type": "ulb",
     "resource_code": "tit"},
    {"lang_code": "mr",
     "resource_type": "udb",
     "resource_code": "mrk"},
]


res = requests.post("http://localhost:5005/api/v1/document", json=json.dumps(payload))
if res.ok:
    print(res.json())
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org838beab" class="outline-3">
<h3 id="org838beab"><span class="section-number-3">1.3</span> Interactions at a high level</h3>
<div class="outline-text-3" id="text-1-3">

<div id="org1df87f5" class="figure">
<p><img src="wa_design_sequence_diagram1.png" alt="wa_design_sequence_diagram1.png" />
</p>
</div>


<p>
<code>DocumentGenerator</code> passes back a JSON dict containing any messaging and
the eventual location of the generated document for display to the
requesting user (by <code>BIEL</code>), or the document itself (depending on how
long it takes to generate).
</p>


<div id="orgabe1176" class="figure">
<p><img src="wa_design_sequence_diagram2.png" alt="wa_design_sequence_diagram2.png" />
</p>
</div>


<p>
A problem with the old design was that it had one class, <code>TnConverter</code>,
doing all the work. This monolithic design resulted in copious
conditional logic in order to deal with handling different types of
resources differently, e.g., USFM files, translation notes, etc..
</p>

<p>
This new version of the design has extracted logic paths unique to
each resource type and relocated them into Resource subclasses,
created via a factory method (<code>ResourceFactory</code>). These subclasses share
a clean interface: <code>find_location</code>, <code>get_files</code>, <code>initialize_properties</code>,
<code>get_content</code>. The work of <code>find_location</code> is delegated to
<code>ResourceJsonLookup</code> for all instances. <code>get_files</code> is also common to all
subclasses and not specialized from the <code>Resource</code> superclass.
Specialization in each subclass happens in the <code>initialize_properties</code>
and <code>get_content</code> methods.
</p>

<p>
This new design has also replaced the design of passing around a
dictionary within <code>DocumentGenerator</code>. Each resource that is part of a
single document request is now fully reified into its own object and
<code>DocumentGenerator</code> maintains a collection of these Resource instances.
</p>

<p>
<code>DocumentGenerator</code> also now maintains a unique key for each particular
collection of resources in the document generation request. This will
make it possible in a future design to simply lookup, if it exists, an
already finalized and generated document if one with the same
resources and order has been requested in the past. This should
greatly improve UX experience due to cutting out all the document
generation processing time.
</p>


<div id="orgb90ec76" class="figure">
<p><img src="wa_design_class_diagram_resources.png" alt="wa_design_class_diagram_resources.png" />
</p>
</div>


<p>
The interface for ResourceLookup has not changed since the last
design, but some of the underlying implementation details have that
are not relevant to this design document.
</p>


<div id="orgedd364b" class="figure">
<p><img src="wa_design_class_diagram.png" alt="wa_design_class_diagram.png" />
</p>
</div>


<p>
As mentioned above a <code>DocumentGenerator</code> accepts a document generation
request composed of resources. <code>DocumentGenerator</code> instantiates the
appropriate <code>Resource</code> subclass based on the resource type. Each
<code>Resource</code> instance composes one <code>ResourceJsonLookup</code> to which it delegates
lookup tasks.
</p>


<div id="orge7a9fa4" class="figure">
<p><img src="wa_design_class_diagram2.png" alt="wa_design_class_diagram2.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orge41a37c" class="outline-3">
<h3 id="orge41a37c"><span class="section-number-3">1.4</span> What works currently</h3>
<div class="outline-text-3" id="text-1-4">
<ol class="org-ol">
<li>Making a request for document generation to the web service (flask) running.</li>
<li>The resources that comprise the document generation request can handle a book-level of request granularity at present.</li>
<li>Resources are found and provisioned to disk (but not yet typeset
into a final document &#x2013; this is mainly where my efforts are focused
currently).</li>
</ol>
<p>
Files involved: <code>flask_app.py</code>, <code>resource_lookup.py</code>,
<code>document_generator.py</code>, <code>resource.py</code> (and <code>config.py</code>, <code>file_utils.py</code>,
<code>url_utils.py</code>, and my clone of <code>USFM-Tools</code> repo).
</p>
</div>
</div>
<div id="outline-container-org81eb4ed" class="outline-3">
<h3 id="org81eb4ed"><span class="section-number-3">1.5</span> Docker container</h3>
<div class="outline-text-3" id="text-1-5">
<p>
There isn't much to say about the docker container except that it
provides the runtime environment, obviously. The only significant new
detail is that flask can be specified to run on a particular IP and
port (seen in <code>docker-compose.yaml</code>) which <code>BIEL</code> will know and use when
submitting requests.
</p>

<p>
In a later iteration toward the end, flask will presumably be load
balanced. Further, to protect its pool of workers from being tied up
by long running client requests from <code>BIEL</code>, one can adopt an
architecture such as the one described in the next paragraph.
</p>

<p>
<code>nginx</code> in front of <code>gnunicorn</code> in front of flask could be put in place to
handle load balancing incoming front end requests from <code>BIEL</code>. To learn
why you might do something like that please see this <a href="https://stackoverflow.com/questions/20766684/what-benefit-is-added-by-using-gunicorn-nginx-flask#20766961">stackoverflow
answer</a>
</p>

<p>
I am not bothering myself with this at all right now, just mentioning
it. There are other architectures that could be used when we get
there.
</p>
</div>
</div>
<div id="outline-container-orgc8dfeb0" class="outline-3">
<h3 id="orgc8dfeb0"><span class="section-number-3">1.6</span> How to run a demo for yourself</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-orgcc8eb61" class="outline-4">
<h4 id="orgcc8eb61"><span class="section-number-4">1.6.1</span> Set up for demos</h4>
<div class="outline-text-4" id="text-1-6-1">
<ol class="org-ol">
<li>Get the tools repo:</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">git clone https://github.com/linearcombination/tools.git
</pre>
</div>

<ol class="org-ol">
<li>Install the required python packages. I use pipenv, but you can do it however you prefer:</li>
</ol>

<p>
I do:
</p>

<div class="org-src-container">
<pre class="src src-shell">pipenv --python /path/to/python/3.8.5 # I think this will work if you point it at any python3 though.
</pre>
</div>

<p>
then
</p>

<div class="org-src-container">
<pre class="src src-shell">pipenv shell # get in the pipenv, virtualenv, conda, whatever shell
</pre>
</div>

<p>
then
</p>

<div class="org-src-container">
<pre class="src src-shell"># You can do just this one if you don't want to bother with virtual
# envs. With pipenv as you probably know, this will make a virtual env
# only install of the requirements only accessible after: pipenv
# shell.
pip install -r requirements.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc90937b" class="outline-4">
<h4 id="orgc90937b"><span class="section-number-4">1.6.2</span> Run demo outside Docker container (faster)</h4>
<div class="outline-text-4" id="text-1-6-2">
</div>
<div id="outline-container-org85daf53" class="outline-5">
<h5 id="org85daf53"><span class="section-number-5">1.6.2.1</span> For <code>resource_lookup.py</code>:</h5>
<div class="outline-text-5" id="text-1-6-2-1">
<p>
In pipenv or virtualenv shell:
</p>

<div class="org-src-container">
<pre class="src src-shell">python -m test_resource_lookup
</pre>
</div>

<p>
You should see a lot of output resulting from the tests doing various
lookups into the translations.json file after first acquiring it if
needed.
</p>
</div>
</div>
<div id="outline-container-orgf7d0ac1" class="outline-5">
<h5 id="orgf7d0ac1"><span class="section-number-5">1.6.2.2</span> For <code>document_generator.py</code> (used to be named <code>export_md_to_pdf.py</code>):</h5>
<div class="outline-text-5" id="text-1-6-2-2">
<div class="org-src-container">
<pre class="src src-shell">python -m test_document_generator
</pre>
</div>

<p>
This will go a long ways, but eventually die before generating a final
document.
</p>
</div>
</div>

<div id="outline-container-org3d31383" class="outline-5">
<h5 id="org3d31383"><span class="section-number-5">1.6.2.3</span> For testing the web service front end do:</h5>
<div class="outline-text-5" id="text-1-6-2-3">
<ol class="org-ol">
<li>First, run the web server</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">./run_flask.sh
</pre>
</div>

<ol class="org-ol">
<li>In a pipenv or virtualenv shell do:</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">python -m test_flask
</pre>
</div>

<p>
This will run HTTP web client tests that exercise the web service.
</p>
</div>
</div>
</div>

<div id="outline-container-org10c2c48" class="outline-4">
<h4 id="org10c2c48"><span class="section-number-4">1.6.3</span> For demo inside the Docker container (slower):</h4>
<div class="outline-text-4" id="text-1-6-3">
<ul class="org-ul">
<li>Get the docker container source:</li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">git clone https://github.com/linearcombination/Interleaved_Resources_Generator
</pre>
</div>

<ul class="org-ul">
<li>cd into the container repo root dir from step 1a above.</li>

<li>Symbolically link the tools directory from earlier into the root of the container repo you cloned earlier:</li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">ln -s /path/to/tools .
</pre>
</div>

<ul class="org-ul">
<li>Build the container:</li>
</ul>

<p>
Special note: don't run the ./build.sh script in a <code>fish</code> shell as
<code>fish</code> doesn't understand use of dollar sign to reference shell vars.
</p>
<div class="org-src-container">
<pre class="src src-shell">./build.sh # This will take a little while to build the container. When it completes building it will automatically start the web server front end.
</pre>
</div>

<p>
If you want to rebuild the container after a git pull do:
</p>

<div class="org-src-container">
<pre class="src src-shell">docker ps -a # This will get the ID, first column, that you need to be able to remove the container for a rebuild
docker rm ID # ID here is the ID from the previous step
</pre>
</div>

<p>
then repeat 3 again.
</p>

<ul class="org-ul">
<li>Submit client requests (you need to be in the tools repo root directory as before):</li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">python -m test_flask
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4839fe2" class="outline-3">
<h3 id="org4839fe2"><span class="section-number-3">1.7</span> (Bonus/optional material) Convenience web service endpoints for BIEL UI to call (if desired)</h3>
<div class="outline-text-3" id="text-1-7">
<p>
In the interest of good user experience, it will be important that
<code>BIEL</code> only request resources that actually exist (as defined by
<code>translations.json</code>).
</p>

<p>
I've provided a couple of web app endpoints from which <code>BIEL</code> can
request data in order to populate its dropdown menu's in <code>BIEL</code>'s
document request wizard.
</p>
</div>

<div id="outline-container-orgd055a6c" class="outline-4">
<h4 id="orgd055a6c"><span class="section-number-4">1.7.1</span> Example client call to get all language codes (sans language name)</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
Example client call from <code>test_flask.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python">import json
import requests

res = requests.get("http://localhost:5005/api/v1/language_codes")
if res.ok:
print(res.json()) # Presumably, BIEL'll display it in a drop down menu or similar.
</pre>
</div>
</div>
</div>
<div id="outline-container-org6fa2dd8" class="outline-4">
<h4 id="org6fa2dd8"><span class="section-number-4">1.7.2</span> Get all language code, language name pairs</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
Example client call from <code>test_flask.py</code>.
</p>

<div class="org-src-container">
<pre class="src src-python">import json
import requests

res = requests.get("http://localhost:5005/api/v1/language_codes_and_names")
if res.ok:
    print(res.json()) # Presumably, BIEL'll display it in a drop down menu or similar.
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf9a4226" class="outline-3">
<h3 id="orgf9a4226"><span class="section-number-3">1.8</span> Oddities - differences from the norm in resources I've found</h3>
<div class="outline-text-3" id="text-1-8">
<p>
These are oddities that are not currently handled, either at all or
totally, either by the original system or the current system.
</p>

<p>
Examples:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Language code</th>
<th scope="col" class="org-left">Resource type</th>
<th scope="col" class="org-left">Resource code</th>
<th scope="col" class="org-left">Oddity</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ml</td>
<td class="org-left">tn</td>
<td class="org-left">any</td>
<td class="org-left">zip contains a manifest.yaml per usual, but the translation</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">notes are not in markdown they are tsv files.</td>
</tr>

<tr>
<td class="org-left">erk-x-erakor</td>
<td class="org-left">reg</td>
<td class="org-left">any</td>
<td class="org-left">manifest.json rather than manifest.txt or manifest.yaml.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">manifest.json has different structure and keys.</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orge00f25f" class="outline-4">
<h4 id="orge00f25f"><span class="section-number-4">1.8.1</span> <span class="todo TODO">TODO</span> for Craig: a license for the <code>Interleaved_Resources_Generator</code> project</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
I need a license emailed to me that I can check in to the repo. Or you
can send me a link to the license and I'll get it there. Thanks!
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2020-10-28 Wed 14:11</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
