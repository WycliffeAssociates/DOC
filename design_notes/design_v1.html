<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-09-20 Sun 22:34 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga41c367">1. Design notes</a>
<ul>
<li><a href="#org007dfb6">1.1. JSON document generation request design for web client (BIEL)</a>
<ul>
<li><a href="#org4dc1d12">1.1.1. <span class="todo TODO">TODO</span> Question: What is the smallest level of resource request granularity we want: book, chapter, or verse?</a></li>
<li><a href="#org535e571">1.1.2. <span class="todo TODO">TODO</span> for Craig: a license for the <code>Interleaved_Resources_Generator</code> project</a></li>
<li><a href="#org3a59193">1.1.3. Example request from <code>test_flask.py</code></a></li>
</ul>
</li>
<li><a href="#orgca43aa8">1.2. Interactions at a high level</a></li>
<li><a href="#orge398ab3">1.3. What works currently</a></li>
<li><a href="#org1a7531a">1.4. Concept of resource in system</a></li>
<li><a href="#org73888cc">1.5. Docker container</a></li>
<li><a href="#org114cf26">1.6. How to run a demo for yourself</a>
<ul>
<li><a href="#org01981a6">1.6.1. Set up for demos</a></li>
<li><a href="#orgde1daaf">1.6.2. Run demo outside docker container (faster)</a>
<ul>
<li><a href="#org6ec7f5e">1.6.2.1. For resource<sub>lookup.py</sub>:</a></li>
<li><a href="#org4489b35">1.6.2.2. For document<sub>generator.py</sub> (used to be named export<sub>md</sub><sub>to</sub><sub>pdf.py</sub>):</a></li>
<li><a href="#orge6e41db">1.6.2.3. For testing the web service front end do:</a></li>
</ul>
</li>
<li><a href="#org2987309">1.6.3. For demo inside the docker container:</a></li>
</ul>
</li>
<li><a href="#orgaaca885">1.7. (Bonus/optional material) Convenience web service endpoints for BIEL UI to call (if desired)</a>
<ul>
<li><a href="#orgb36bceb">1.7.1. Example client call to get all language codes by themselves</a></li>
<li><a href="#org1397c73">1.7.2. Get all language code, language name pairs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orga41c367" class="outline-2">
<h2 id="orga41c367"><span class="section-number-2">1</span> Design notes</h2>
<div class="outline-text-2" id="text-1">
<p>
Let's start off with how BIEL sends a document generation request that
specifies what (arbitrary) combination of resources a user would like
included in the final PDF document.
</p>
</div>
<div id="outline-container-org007dfb6" class="outline-3">
<h3 id="org007dfb6"><span class="section-number-3">1.1</span> JSON document generation request design for web client (BIEL)</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Requirement: Allow creating a document out of any combination of
resources from any supported (in translations.json) language.
</p>

<p>
At present we are at the stage of matching the functionality of the
prior system with respect to granularity of selection of bible
material, i.e., book-level granularity.
</p>

<p>
Currently the JSON looks like this, for example:
</p>

<div class="org-src-container">
<pre class="src src-js">{ "resources":
  { "lang_code": "am", "resource_type": "ulb", "resource_code": "gen" },
  { "lang_code": "lpx", "resource_type": "tn", "resource_code": "exo" },
  ...
}
</pre>
</div>

<p>
Each element in the JSON dictionary represents a resource. The whole
dictionary represents all the resources you want in the final typeset
document in the order you want them. Note that last point, the order.
That could of course be changed, but I am for now making an assumption
that BIEL's wizard would compose a JSON document generation request
having resources in the order the user requested the documents
resources to be represented.
</p>
</div>

<div id="outline-container-org4dc1d12" class="outline-4">
<h4 id="org4dc1d12"><span class="section-number-4">1.1.1</span> <span class="todo TODO">TODO</span> Question: What is the smallest level of resource request granularity we want: book, chapter, or verse?</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
In the resource entries below note that I've changed <code>resource_code</code> to
<code>book_code</code> just because it might be a better name than <code>resource_code</code>.
</p>

<p>
Perhaps book level granularity is sufficient, but just covering it
here in case. More granular than book level would require a design
that I can envision but would require interrogating the resource
itself rather than just the translations.json API.
</p>

<p>
So, the following rest of this headline is probably a diversion, but
here it is just in case you want finer than book granularity.
</p>

<p>
If chapter is the finest granularity of a resource request, the JSON could be:
</p>
<div class="org-src-container">
<pre class="src src-js">{ "resources":
  { "lang_code": "am",
    "resource_type": "ulb",
    "book_code": "gen",
    "book_chapter": "1" }, // Get just chapter 1
  { "lang_code": "lpx",
    "resource_type": "tn",
    "book_code": "exo",
    "book_chapter": "" }, // Get the whole book
  ...
}
</pre>
</div>


<p>
If verse is the finest granularity of a resource request, the JSON could be:
</p>
<div class="org-src-container">
<pre class="src src-js">{ "resources":
  { "lang_code": "am",
    "resource_type": "ulb",
    "book_code": "gen",
    "book_chapter": "1",
    "verse_start": "1",
    "verse_end": "3" }, // Get chapter 1, verse 1-3
  { "lang_code": "am",
    "resource_type": "ulb",
    "book_code": "gen",
    "book_chapter": "1",
    "verse_ranget": "1-1" }, // Or, Get chapter 1, verse 1
  { "lang_code": "am",
    "resource_type": "ulb",
    "book_code": "gen",
    "book_chapter": "1",
    "verse_ranget": "1-3" }, // Or, Get chapter 1, verse 1-3
  { "lang_code": "am",
    "resource_type": "ulb",
    "book_code": "gen",
    "book_chapter": "1",
    "verse_ranget": "1-3,5" }, // Or, Get chapter 1, verse 1-3 and verse 5
  { "lang_code": "lpx",
    "resource_type": "tn",
    "book_code": "exo",
    "book_chapter": "2" }, // Get chapter 2
  { "lang_code": "lpx",
    "resource_type": "tn",
    "book_code": "exo",
    "book_chapter": "" }, // Get the whole book
  ...
}
</pre>
</div>

<p>
As said before in a slightly different context, ideally from a user
experience perspective, BIEL would need to know what chapters or
verses are available so as not to disappoint the user. Nevertheless,
the system is being designed to gracefully handle such disappointments
as I know this is a requirement.
</p>
</div>
</div>
<div id="outline-container-org535e571" class="outline-4">
<h4 id="org535e571"><span class="section-number-4">1.1.2</span> <span class="todo TODO">TODO</span> for Craig: a license for the <code>Interleaved_Resources_Generator</code> project</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
I need a license emailed to me that I can check in to the repo. Or you
can send me a link to the license and I'll get it there. Thanks!
</p>
</div>
</div>
<div id="outline-container-org3a59193" class="outline-4">
<h4 id="org3a59193"><span class="section-number-4">1.1.3</span> Example request from <code>test_flask.py</code></h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
Example python client request using resources JSON dictionary to submit an
API call to generate a document composed of resources.
</p>

<div class="org-src-container">
<pre class="src src-python">import json
import requests

payload = {}
payload["resources"] = [
    {"lang_code": "am",
     "resource_type": "ulb",
     "resource_code": ""},
    {"lang_code": "erk-x-erakor",
     "resource_type": "reg",
     "resource_code": "eph"},
    {"lang_code": "ml",
     "resource_type": "ulb",
     "resource_code": "tit"},
    {"lang_code": "ml",
     "resource_type": "obs-tq",
     "resource_code": ""},
    {"lang_code": "mr",
     "resource_type": "udb",
     "resource_code": "mrk"},
]


res = requests.post("http://localhost:5005/api/v1/document", json=json.dumps(payload))
if res.ok:
    print(res.json())
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgca43aa8" class="outline-3">
<h3 id="orgca43aa8"><span class="section-number-3">1.2</span> Interactions at a high level</h3>
<div class="outline-text-3" id="text-1-2">

<div id="org5381d16" class="figure">
<p><img src="wa_design_sequence_diagram1.png" alt="wa_design_sequence_diagram1.png" />
</p>
</div>


<p>
<code>DocumentGenerator</code> passes back a JSON dict containing any messaging and
the eventual location of the generated document for display to the
requesting user (by BIEL).
</p>


<div id="org8c523d2" class="figure">
<p><img src="wa_design_sequence_diagram2.png" alt="wa_design_sequence_diagram2.png" />
</p>
</div>

<p>
Note that, of course, <code>DocumentGenerator</code> iterates through the resources
and submits each resource to be found and provisioned, so "find
resource" in the image above is happening in a loop through each
resource. Similary for <code>ResourceDownloader</code>.
</p>


<div id="orgbf72847" class="figure">
<p><img src="wa_design_class_diagram.png" alt="wa_design_class_diagram.png" />
</p>
</div>



<div id="org4ebbc98" class="figure">
<p><img src="wa_design_class_diagram2.png" alt="wa_design_class_diagram2.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orge398ab3" class="outline-3">
<h3 id="orge398ab3"><span class="section-number-3">1.3</span> What works currently</h3>
<div class="outline-text-3" id="text-1-3">
<ol class="org-ol">
<li>Making a request for document generation to the web service (flask) running.</li>
<li>The resources that comprise the document generation request can handle a book-level of request granularity at present.</li>
<li>Resources are found and provisioned to disk (but not yet typeset into a final document).</li>
</ol>
<p>
Files involved: <code>flask_app.py</code>, <code>resource_lookup.py</code>,
<code>document_generator.py</code> (and <code>config.py</code>, <code>file_utils.py</code>, <code>url_utils.py</code>).
</p>
</div>
</div>
<div id="outline-container-org1a7531a" class="outline-3">
<h3 id="org1a7531a"><span class="section-number-3">1.4</span> Concept of resource in system</h3>
<div class="outline-text-3" id="text-1-4">
<p>
What follows is more than you really need to know, but I feel it is
worth an explanation since you are observing the evolution of a code
base that is very much in flux and far from complete.
</p>

<p>
At present, because the final form of the data structures are not yet
solidified I have found it advantageous to pass around a dictionary
that is a reification of the original JSON document generation request
(this is seen in both <code>ResourceJsonLookup</code> and <code>DocumentGenerator</code>. This
has been nice because prior to refactoring the legacy portion of this
system, <code>export_md_to_pdf.py</code> (which is now named
<code>document_generator.py</code>), I can update said dictionary with fields as I
need them. A dictionary during this stage of development provides the
flexibility to not commit to a design yet. Adding additional key/value
pairs to the dictionary like <code>resource_dir</code>, <code>resource_file_format</code>, etc.
is simple. These additional fields store data that are important for a
resource to know about itself so that its related files can be
provisioned to disk and subsequently found and used by the document
generation processes themselves (for things like Markdown to HTML
conversion, HTML to PDF conversion, etc..).
</p>

<p>
The use of the dictionary may (likely) change as the proper data
structures emerge from the evolving design. Of course, this is
solution domain stuff and so not something you should be concerning
yourself with as it doesn't have to do with requirements. Things will
continue to change from iteration to iteration.
</p>
</div>
</div>
<div id="outline-container-org73888cc" class="outline-3">
<h3 id="org73888cc"><span class="section-number-3">1.5</span> Docker container</h3>
<div class="outline-text-3" id="text-1-5">
<p>
There isn't much to say about the docker container except that it
provides the runtime environment, obviously. The only significant new
detail is that flask can be specified to run on a particular IP and
port (seen in <code>docker-compose.yaml</code>) which BIEL will know and use when
submitting requests.
</p>

<p>
In a later iteration toward the end, flask will presumably be load
balanced. Further, to protect its pool of workers from being tied up
by long running client requests from BIEL, one can adopt an
architecture such as the one described in the next paragraph.
</p>

<p>
nginx in front of gnunicorn in front of flask could be put in place to
handle load balancing incoming front end requests from BIEL. To learn
why you might do something like that please see this <a href="https://stackoverflow.com/questions/20766684/what-benefit-is-added-by-using-gunicorn-nginx-flask#20766961">stackoverflow
answer</a>
</p>

<p>
I am not bothering myself with this at all right now, just
mentioning it. There are plenty of other architectures that could be
used when we get there.
</p>
</div>
</div>
<div id="outline-container-org114cf26" class="outline-3">
<h3 id="org114cf26"><span class="section-number-3">1.6</span> How to run a demo for yourself</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-org01981a6" class="outline-4">
<h4 id="org01981a6"><span class="section-number-4">1.6.1</span> Set up for demos</h4>
<div class="outline-text-4" id="text-1-6-1">
<ol class="org-ol">
<li>Get the tools repo:</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">git clone "https://github.com/linearcombination/tools.git" -b develop --single-branch
</pre>
</div>

<ol class="org-ol">
<li>Install the required python packages. I use pipenv, but you can do it however you prefer:</li>
</ol>

<p>
I do:
</p>

<div class="org-src-container">
<pre class="src src-shell">pipenv --python /path/to/python/3.8.5 # I think this will work if you point it at any python3 though.
</pre>
</div>

<p>
then
</p>

<div class="org-src-container">
<pre class="src src-shell">pipenv shell # get in the pipenv, virtualenv, conda, whatever shell
</pre>
</div>

<p>
then
</p>

<div class="org-src-container">
<pre class="src src-shell"># You can do just this one if you don't want to bother with virtual
# envs. With pipenv as you probably know, this will make a virtual env
# only install of the requirements only accessible after: pipenv
# shell.
pip install -r requirements.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde1daaf" class="outline-4">
<h4 id="orgde1daaf"><span class="section-number-4">1.6.2</span> Run demo outside docker container (faster)</h4>
<div class="outline-text-4" id="text-1-6-2">
</div>
<div id="outline-container-org6ec7f5e" class="outline-5">
<h5 id="org6ec7f5e"><span class="section-number-5">1.6.2.1</span> For resource<sub>lookup.py</sub>:</h5>
<div class="outline-text-5" id="text-1-6-2-1">
<p>
In pipenv or virtualenv shell:
</p>

<div class="org-src-container">
<pre class="src src-shell">python -m test_resource_lookup
</pre>
</div>

<p>
You should see a lot of output resulting from the tests doing various
lookups into the translations.json file after first acquiring it if
needed. At the moment this runs fine without known error. But since
this system is in flux there is always a chance I'll have accidentally
left the develop branch (the main branch) in a state that is not
optimal for demoing.
</p>
</div>
</div>

<div id="outline-container-org4489b35" class="outline-5">
<h5 id="org4489b35"><span class="section-number-5">1.6.2.2</span> For document<sub>generator.py</sub> (used to be named export<sub>md</sub><sub>to</sub><sub>pdf.py</sub>):</h5>
<div class="outline-text-5" id="text-1-6-2-2">
<div class="org-src-container">
<pre class="src src-shell">python -m test_document_generator
</pre>
</div>

<p>
This will go a long ways, but eventually die before generating a
document.
</p>
</div>
</div>

<div id="outline-container-orge6e41db" class="outline-5">
<h5 id="orge6e41db"><span class="section-number-5">1.6.2.3</span> For testing the web service front end do:</h5>
<div class="outline-text-5" id="text-1-6-2-3">
<ol class="org-ol">
<li>First, run the web server</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">./run_flask.sh
</pre>
</div>

<ol class="org-ol">
<li>In a pipenv or virtualenv shell do:</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">python -m test_flask
</pre>
</div>

<p>
This will run HTTP web client tests that exercise the web service.
</p>
</div>
</div>
</div>

<div id="outline-container-org2987309" class="outline-4">
<h4 id="org2987309"><span class="section-number-4">1.6.3</span> For demo inside the docker container:</h4>
<div class="outline-text-4" id="text-1-6-3">
<p>
1a. Get the docker container source:
</p>

<div class="org-src-container">
<pre class="src src-shell">git clone https://github.com/linearcombination/Interleaved_Resources_Generator
</pre>
</div>


<p>
1b. cd into the container repo root dir from step 1a above.
</p>

<ol class="org-ol">
<li>Symbolically link the tools directory from earlier into the root of the container repo you cloned earlier:</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">ln -s /path/to/tools .
</pre>
</div>

<ol class="org-ol">
<li>Build the container:</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">./build.sh # This will take a little while to build the container. When it completes building it will automatically start the web server front end.
</pre>
</div>

<p>
If you want to rebuild the container after a git pull do:
</p>

<div class="org-src-container">
<pre class="src src-shell">docker ps -a # This will get the ID, first column, that you need to be able to remove the container for a rebuild
docker rm ID # ID here is the ID from the previous step
</pre>
</div>

<p>
then repeat 3 again.
</p>

<ol class="org-ol">
<li>Submit client requests as before (you need to be in the tools repo root directory as before):</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">python -m test_flask
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaaca885" class="outline-3">
<h3 id="orgaaca885"><span class="section-number-3">1.7</span> (Bonus/optional material) Convenience web service endpoints for BIEL UI to call (if desired)</h3>
<div class="outline-text-3" id="text-1-7">
<p>
A nice property for a system like this to have is a ground truth data
source so that front end (BIEL) and back end are on same page about
what resources are available.
</p>

<p>
For now, that ground truth data source is the latest copy of
translations.json that <code>ResourceJsonLookup</code> obtains and keeps fresh to
within each 24 hour window. (This works fine, but I may make this more
sophisticated later).
</p>

<p>
Toward that goal of one ground truth data source for BIEL and this
system to coincide with this system provides to BIEL a couple of web
app endpoints that it can request data from to populate its dropdown
menu's in BIEL's document request wizard. These endpoints were easy to
make, so I am providing them.
</p>

<p>
It would be a bad user experience for BIEL users to be able to request
a resource which does not exist (but that is outside my scope per
requirements). For now, if these endpoints are used, we at least make
sure only languages that are provided in (the same version of)
translations.json are available for selection. Maybe later we'll go
further and actually provide endpoints that return the resources
available per language also. If those endpoints were built, they could
also be used by BIEL to populate resource type and book dropdown
menus. Just putting it out there though we haven't talked about it.
</p>

<p>
The system is being designed to gracefully handle non-existent
requested resources per requirements, but naturally you'd want to
avoid this if possible.
</p>

<p>
These endpoints were quick to create and were used in part to test
flask and jsonpath performance (you'll note that it is one place I
don't use jsonpath since performance in this one case was
unacceptable). So consider these endpoints a happy byproduct of
development, but that could be expanded to provide a better overall
user expeience if desired.
</p>
</div>
<div id="outline-container-orgb36bceb" class="outline-4">
<h4 id="orgb36bceb"><span class="section-number-4">1.7.1</span> Example client call to get all language codes by themselves</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
Example client call from <code>test_flask.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python">import json
import requests

res = requests.get("http://localhost:5005/api/v1/language_codes")
if res.ok:
print(res.json()) # Presumably, BIEL'll display it in a drop down menu or similar.
</pre>
</div>
</div>
</div>
<div id="outline-container-org1397c73" class="outline-4">
<h4 id="org1397c73"><span class="section-number-4">1.7.2</span> Get all language code, language name pairs</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
Example client call from <code>test_flask.py</code>.
</p>

<div class="org-src-container">
<pre class="src src-python">import json
import requests

res = requests.get("http://localhost:5005/api/v1/language_codes_and_names")
if res.ok:
    print(res.json()) # Presumably, BIEL'll display it in a drop down menu or similar.
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2020-09-20 Sun 22:34</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
